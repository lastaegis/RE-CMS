{"version":3,"sources":["../../../../../../../../../../resources/assets/plugins/backend/select2-4.0.3/src/js/select2/selection/base.js"],"names":["define","$","Utils","KEYS","BaseSelection","$element","options","__super__","constructor","call","Extend","Observable","prototype","render","$selection","_tabindex","data","attr","bind","container","$container","self","id","resultsId","on","evt","trigger","_handleBlur","which","SPACE","preventDefault","params","_resultId","update","_attachCloseHandler","removeAttr","focus","_detachCloseHandler","window","setTimeout","document","activeElement","contains","body","e","$target","target","$select","closest","$all","each","$this","select2","off","position","$selectionContainer","find","append","destroy","Error"],"mappings":"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","file":"base.js","sourcesContent":["define([\n  'jquery',\n  '../utils',\n  '../keys'\n], function ($, Utils, KEYS) {\n  function BaseSelection ($element, options) {\n    this.$element = $element;\n    this.options = options;\n\n    BaseSelection.__super__.constructor.call(this);\n  }\n\n  Utils.Extend(BaseSelection, Utils.Observable);\n\n  BaseSelection.prototype.render = function () {\n    var $selection = $(\n      '<span class=\"select2-selection\" role=\"combobox\" ' +\n      ' aria-haspopup=\"true\" aria-expanded=\"false\">' +\n      '</span>'\n    );\n\n    this._tabindex = 0;\n\n    if (this.$element.data('old-tabindex') != null) {\n      this._tabindex = this.$element.data('old-tabindex');\n    } else if (this.$element.attr('tabindex') != null) {\n      this._tabindex = this.$element.attr('tabindex');\n    }\n\n    $selection.attr('title', this.$element.attr('title'));\n    $selection.attr('tabindex', this._tabindex);\n\n    this.$selection = $selection;\n\n    return $selection;\n  };\n\n  BaseSelection.prototype.bind = function (container, $container) {\n    var self = this;\n\n    var id = container.id + '-container';\n    var resultsId = container.id + '-results';\n\n    this.container = container;\n\n    this.$selection.on('focus', function (evt) {\n      self.trigger('focus', evt);\n    });\n\n    this.$selection.on('blur', function (evt) {\n      self._handleBlur(evt);\n    });\n\n    this.$selection.on('keydown', function (evt) {\n      self.trigger('keypress', evt);\n\n      if (evt.which === KEYS.SPACE) {\n        evt.preventDefault();\n      }\n    });\n\n    container.on('results:focus', function (params) {\n      self.$selection.attr('aria-activedescendant', params.data._resultId);\n    });\n\n    container.on('selection:update', function (params) {\n      self.update(params.data);\n    });\n\n    container.on('open', function () {\n      // When the dropdown is open, aria-expanded=\"true\"\n      self.$selection.attr('aria-expanded', 'true');\n      self.$selection.attr('aria-owns', resultsId);\n\n      self._attachCloseHandler(container);\n    });\n\n    container.on('close', function () {\n      // When the dropdown is closed, aria-expanded=\"false\"\n      self.$selection.attr('aria-expanded', 'false');\n      self.$selection.removeAttr('aria-activedescendant');\n      self.$selection.removeAttr('aria-owns');\n\n      self.$selection.focus();\n\n      self._detachCloseHandler(container);\n    });\n\n    container.on('enable', function () {\n      self.$selection.attr('tabindex', self._tabindex);\n    });\n\n    container.on('disable', function () {\n      self.$selection.attr('tabindex', '-1');\n    });\n  };\n\n  BaseSelection.prototype._handleBlur = function (evt) {\n    var self = this;\n\n    // This needs to be delayed as the active element is the body when the tab\n    // key is pressed, possibly along with others.\n    window.setTimeout(function () {\n      // Don't trigger `blur` if the focus is still in the selection\n      if (\n        (document.activeElement == self.$selection[0]) ||\n        ($.contains(self.$selection[0], document.activeElement))\n      ) {\n        return;\n      }\n\n      self.trigger('blur', evt);\n    }, 1);\n  };\n\n  BaseSelection.prototype._attachCloseHandler = function (container) {\n    var self = this;\n\n    $(document.body).on('mousedown.select2.' + container.id, function (e) {\n      var $target = $(e.target);\n\n      var $select = $target.closest('.select2');\n\n      var $all = $('.select2.select2-container--open');\n\n      $all.each(function () {\n        var $this = $(this);\n\n        if (this == $select[0]) {\n          return;\n        }\n\n        var $element = $this.data('element');\n\n        $element.select2('close');\n      });\n    });\n  };\n\n  BaseSelection.prototype._detachCloseHandler = function (container) {\n    $(document.body).off('mousedown.select2.' + container.id);\n  };\n\n  BaseSelection.prototype.position = function ($selection, $container) {\n    var $selectionContainer = $container.find('.selection');\n    $selectionContainer.append($selection);\n  };\n\n  BaseSelection.prototype.destroy = function () {\n    this._detachCloseHandler(this.container);\n  };\n\n  BaseSelection.prototype.update = function (data) {\n    throw new Error('The `update` method must be defined in child classes.');\n  };\n\n  return BaseSelection;\n});\n"]}